<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galeria Coworking Odontol√≥gico</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FBF8E9', // Bege Claro (Fundo Principal)
                        secondary: '#FBF8E9', // Bege Claro (Fundo de Se√ß√µes)
                        accent: '#996E5C', // Cobre/Marrom (Destaque, Bot√µes, Destaque de Texto)
                        textdark: '#89878C', // Cinza Chumbo (Texto Principal)
                        textlight: '#FBF8E9' // Bege Claro (Texto em fundo escuro)
                    }
                }
            }
        }
    </script>
    <style>
        body {
            box-sizing: border-box;
            color: #89878C; /* Cinza Chumbo */
        }
        
        .logo-principal {
            font-family: ui-serif, Georgia, Cambria, "Times New Roman", Times, serif;
            font-weight: 700;
            text-transform: lowercase; 
        }
        .logo-secundaria {
            font-family: ui-sans-serif, system-ui, sans-serif;
            font-weight: 500;
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #FBF8E9 0%, #EFEBE0 100%); 
        }
        
        .card-hover, .button-effect {
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px -5px rgba(0, 0, 0, 0.1), 0 0 10px rgba(182, 224, 198, 0.5);
        }

        .button-effect:hover::before {
            transform: scale(3.5);
            opacity: 0;
        }

        .button-effect::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            transform: scale(0);
            transition: transform 0.5s ease-out, opacity 0.5s ease-out;
            pointer-events: none;
        }
        
        .calendar-day {
            transition: all 0.2s ease;
        }
        
        .calendar-day:hover {
            background-color: #e0f2fe;
        }
        
        .occupied {
            background-color: #fecaca !important;
            color: #991b1b;
        }
        
        .selected {
            background-color: #996E5C !important; /* Cor accent */
            color: white;
            font-weight: bold;
        }
        
        .fade-in {
            animation: fadeIn 0.8s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .tooltip {
            position: relative;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #3C403B;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
        }
        
        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #3C403B transparent transparent transparent;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
    </style>
    
    <script>
        // 2. CONFIGURA√á√ÉO E INICIALIZA√á√ÉO DO FIREBASE FIRESTORE
        // ‚ö†Ô∏è SUBSTITUA PELAS SUAS CHAVES REAIS DO CONSOLE DO FIREBASE
        const firebaseConfig = {
            apiKey: "___FIREBASE_API_KEY___",
            authDomain: "___FIREBASE_AUTH_DOMAIN___",
            projectId: "___FIREBASE_PROJECT_ID___",
            storageBucket: "___FIREBASE_STORAGE_BUCKET___",
            messagingSenderId: "___FIREBASE_MESSAGING_SENDER_ID___",
            appId: "___FIREBASE_APP_ID___",
            measurementId: "___FIREBASE_MEASUREMENT_ID___"

        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore(app);

        let selectedDate = null;
        let selectedPlan = null;
        let selectedPlanPrice = 0;
        let occupiedSlots = {}; 
        
        /**
         * 3. FUN√á√ÉO PARA BUSCAR DADOS REAIS DO FIREBASE
         */
        async function fetchOccupiedSlots() {
            try {
                const snapshot = await db.collection("reservations").get();
                
                occupiedSlots = {};
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const date = data.date; 
                    
                    if (!occupiedSlots[date]) {
                        occupiedSlots[date] = [];
                    }
                    occupiedSlots[date].push({
                        time: data.time,
                        client: data.clientDescription
                    });
                });
                
                generateCalendar(); 
                
            } catch (error) {
                console.error("Erro ao buscar reservas do Firestore. Verifique API Key e Regras.", error);
                generateCalendar(); 
            }
        }

        function generateCalendar() {
            const calendar = document.getElementById('calendar');
            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();
            
            const firstDay = new Date(currentYear, currentMonth, 1);
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            const startingDayOfWeek = firstDay.getDay();
            
            const monthNames = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
                'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            
            let calendarHTML = `
                <div class="text-center mb-4">
                    <h5 class="text-lg font-semibold">${monthNames[currentMonth]} ${currentYear}</h5>
                </div>
                <div class="grid grid-cols-7 gap-1 mb-2">
                    <div class="text-center text-sm font-medium text-gray-500 p-2">Dom</div>
                    <div class="text-center text-sm font-medium text-gray-500 p-2">Seg</div>
                    <div class="text-center text-sm font-medium text-gray-500 p-2">Ter</div>
                    <div class="text-center text-sm font-medium text-gray-500 p-2">Qua</div>
                    <div class="text-center text-sm font-medium text-gray-500 p-2">Qui</div>
                    <div class="text-center text-sm font-medium text-gray-500 p-2">Sex</div>
                    <div class="text-center text-sm font-medium text-gray-500 p-2">S√°b</div>
                </div>
                <div class="grid grid-cols-7 gap-1">
            `;
            
            for (let i = 0; i < startingDayOfWeek; i++) {
                calendarHTML += '<div class="p-2"></div>';
            }
            
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(currentYear, currentMonth, day);
                const dateString = date.toISOString().split('T')[0];
                
                const todayOnly = new Date(today.getFullYear(), today.getMonth(), today.getDate());
                const currentDayOnly = new Date(currentYear, currentMonth, day);
                const isPast = currentDayOnly < todayOnly; 
                
                const dayOccupied = occupiedSlots[dateString];
                const hasOccupied = dayOccupied && dayOccupied.length > 0;
                
                let dayClass = 'calendar-day p-2 text-center cursor-pointer rounded-lg';
                let tooltipContent = '';
                
                if (isPast) {
                    dayClass += ' text-gray-400 cursor-not-allowed';
                } else if (hasOccupied) {
                    dayClass += ' bg-yellow-100 text-yellow-800 tooltip';
                    const occupiedInfo = dayOccupied.map(slot => {
                        const client = slot.client;
                        if (client.includes('Manh√£')) return 'Manh√£ (08h-12h)';
                        if (client.includes('Tarde')) return 'Tarde (13h-17h)';
                        if (client.includes('Dia Completo')) return 'Dia Completo';
                        return `${slot.time}`; // Para reservas por hora
                    });
                    
                    const uniqueInfo = [...new Set(occupiedInfo)];
                    tooltipContent = `<span class="tooltiptext">Ocupado: ${uniqueInfo.join(', ')}</span>`;
                } else {
                    dayClass += ' hover:bg-primary hover:bg-opacity-50'; 
                }
                
                calendarHTML += `<div class="${dayClass}" onclick="${!isPast ? `selectDate('${dateString}', this)` : ''}">${day}${tooltipContent}</div>`;
            }
            
            calendarHTML += '</div>';
            calendar.innerHTML = calendarHTML;
        }

        function selectDate(dateString, element) {
            document.querySelectorAll('.calendar-day').forEach(day => day.classList.remove('selected'));
            element.classList.add('selected');
            selectedDate = dateString;
            updateTimeSlots();
        }

        /**
         * 4. FUN√á√ÉO updateTimeSlots() CORRIGIDA
         * Adicionado checagem de Plano e Data.
         */
        function updateTimeSlots() {
            const timeSlot = document.getElementById('timeSlot');
            
            if (!selectedPlan || !selectedDate) {
                timeSlot.innerHTML = '<option value="">Selecione plano e data primeiro</option>';
                return;
            }

            const occupiedSlots_day = occupiedSlots[selectedDate] || [];
            // Criamos uma lista de horas que j√° est√£o "pegas" (ex: "08:00")
            const occupiedTimes = occupiedSlots_day.map(slot => slot.time);
            // Criamos uma string com todas as descri√ß√µes para facilitar a busca por "Dia Completo" ou "Turno"
            const descriptions = occupiedSlots_day.map(slot => slot.client).join(' ');

            let options = '<option value="">Selecione o hor√°rio</option>';
            
            if (selectedPlan === 'hora') {
                const hours = ['08:00', '09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00'];
                hours.forEach(hour => {
                    // Bloqueia se a hora exata estiver ocupada OU se o dia todo estiver reservado
                    const isBlocked = occupiedTimes.includes(hour) || descriptions.includes('Dia Completo');
                    if (!isBlocked) {
                        options += `<option value="${hour}">${hour} (1 hora)</option>`;
                    }
                });
                
            
            } else if (selectedPlan === 'turno') {
                const morningBlocked = descriptions.includes('Manh√£') || descriptions.includes('Dia Completo');
                const afternoonBlocked = descriptions.includes('Tarde') || descriptions.includes('Dia Completo');
                
                if (!morningBlocked) options += '<option value="08:00">Turno Manh√£ (08h √†s 12h)</option>';
                if (!afternoonBlocked) options += '<option value="13:00">Turno Tarde (13h √†s 17h)</option>';
            } else if (selectedPlan === 'dia') {
                // S√≥ permite reservar o dia se n√£o houver NENHUMA outra reserva (nem hora, nem turno)
                if (occupiedSlots_day.length === 0) {
                    options += '<option value="08:00">Dia Completo (08h √†s 18h)</option>';
                }
            }
            
            timeSlot.innerHTML = options === '<option value="">Selecione o hor√°rio</option>' 
                ? '<option value="">Sem hor√°rios dispon√≠veis para este plano</option>' 
                : options;
        }

        function selectPlan(plan, price) {
            selectedPlan = plan;
            selectedPlanPrice = price;
            
            const planNames = {
                'hora': 'Por Hora - R$ 70,00',
                'turno': 'Por Turno - R$ 150,00',
                'dia': 'Dia Completo - R$ 300,00'
            };
            
            document.getElementById('selectedPlan').textContent = planNames[plan];
            updateTimeSlots(); 
            calculateTotal();
            
            document.getElementById('booking').scrollIntoView({ behavior: 'smooth' });
        }

        function calculateTotal() {
            let total = selectedPlanPrice;
            let hours = 1;
            
            if (selectedPlan === 'turno') {
                hours = 4;
            } else if (selectedPlan === 'dia') {
                hours = 10;
            }
            
            document.querySelectorAll('input[type="checkbox"]:checked').forEach(checkbox => {
                switch(checkbox.value) {
                    case 'fotopolimerizador': total += 5 * hours; break;
                    case 'ultrassom': total += 5 * hours; break;
                    case 'autoclave': total += 20; break; 
                    case 'laser': total += 20 * hours; break;
                    case 'raioX': total += 50 * hours; break;
                    case 'kitDentistica': total += 20 * hours; break;
                    case 'kitProtese': total += 30 * hours; break;
                    case 'kitCirurgia': total += 80; break; 
                    case 'kitClareamentoConsultorio': total += 65 * hours; break;
                    case 'kitClareamentoCaseiro': total += 90; break; 
                }
            });
            
            document.getElementById('totalPrice').textContent = `R$ ${total.toFixed(2).replace('.', ',')}`;
        }

        function scrollToBooking() {
            document.getElementById('booking').scrollIntoView({ behavior: 'smooth' });
        }

        function copyPixKey() {
            const pixKey = document.getElementById('pixKey').textContent;
            navigator.clipboard.writeText(pixKey).then(() => {
                alert('Chave PIX copiada!');
            });
        }

        function closePixModal() {
            document.getElementById('pixModal').classList.add('hidden');
            document.getElementById('pixModal').classList.remove('flex');
        }

        function closeSuccessModal() {
            document.getElementById('successModal').classList.add('hidden');
            document.getElementById('successModal').classList.remove('flex');
            
            document.getElementById('bookingForm').reset();
            selectedDate = null;
            selectedPlan = null;
            selectedPlanPrice = 0;
            document.getElementById('selectedPlan').textContent = 'Selecione um plano acima';
            document.getElementById('totalPrice').textContent = 'R$ 0,00';
            
            fetchOccupiedSlots(); 
        }

        /**
         * 6. FUN√á√ÉO confirmPayment() PARA SALVAR NO FIRESTORE
         */
        function confirmPayment() {
            // 1. Verificar obrigatoriedade do comprovante
            const fileInput = document.getElementById('pixFile');
            if (!fileInput || !fileInput.files || fileInput.files.length === 0) {
                alert("Por favor, anexe o comprovante do PIX para finalizar sua reserva.");
                return; // Interrompe a fun√ß√£o aqui mesmo
            }

            // Se o arquivo existe, prosseguimos com a l√≥gica
            const timeSlot = document.getElementById('timeSlot').value;
            const clientName = document.getElementById('clientName').value;
            const clientEmail = document.getElementById('email').value;
            const clientCRO = document.getElementById('cro').value;
            const clientPhone = document.getElementById('phone').value;
            
            // Captura o texto do hor√°rio selecionado com seguran√ßa
            const timeSlotSelect = document.getElementById('timeSlot');
            const selectedTimeText = timeSlotSelect.options[timeSlotSelect.selectedIndex].text;
            
            const totalAmountText = document.getElementById('totalPrice').textContent;
            const totalAmount = parseFloat(totalAmountText.replace('R$', '').replace(',', '.').trim());

            const selectedEquipment = [];
            document.querySelectorAll('input[type="checkbox"]:checked').forEach(checkbox => {
                const equipmentNames = {
                    'fotopolimerizador': 'Fotopolimerizador',
                    'ultrassom': 'Ultrassom e jato de bicarbonato',
                    'autoclave': 'Autoclave',
                    'laser': 'Laser de baixa pot√™ncia',
                    'raioX': 'Raio X port√°til com sensor digital',
                    'kitDentistica': 'Kit de dent√≠stica',
                    'kitProtese': 'Kit de pr√≥tese',
                    'kitCirurgia': 'Kit de cirurgia est√©ril',
                    'kitClareamentoConsultorio': 'Kit clareamento consult√≥rio',
                    'kitClareamentoCaseiro': 'Kit clareamento caseiro'
                };
                if (equipmentNames[checkbox.value]) {
                    selectedEquipment.push(equipmentNames[checkbox.value]);
                }
            });
            
            let clientDescription = '';
            if (selectedPlan === 'hora') {
                clientDescription = `${clientName} - ${selectedTimeText} (Hora)`;
            } else if (selectedPlan === 'turno') {
                clientDescription = `${clientName} - Turno ${timeSlot.includes('08:00') ? 'Manh√£' : 'Tarde'}`;
            } else if (selectedPlan === 'dia') {
                clientDescription = `${clientName} - Dia Completo`;
            }
            
            const reservationData = {
                clientName: clientName,
                cro: clientCRO,
                phone: clientPhone,
                email: clientEmail,
                date: selectedDate,
                time: timeSlot,
                clientDescription: clientDescription, 
                plan: selectedPlan,
                totalAmount: totalAmount,
                equipment: selectedEquipment,
                paymentStatus: 'Aguardando Verifica√ß√£o (PIX Anexado)', 
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            };

            // 2. Fechar o modal do PIX apenas ap√≥s a valida√ß√£o do arquivo
            closePixModal();

            // 3. SALVA NO FIRESTORE
            db.collection("reservations").add(reservationData)
                .then((docRef) => {
                    console.log("Reserva salva com ID:", docRef.id);
                    
                    // Envio de e-mails
                    sendEmailConfirmation(clientEmail, clientName, clientCRO, clientPhone, selectedDate, selectedTimeText, selectedPlan, totalAmountText, selectedEquipment);
                    // sendOwnerNotification(clientEmail, clientName, clientCRO, clientPhone, selectedDate, selectedTimeText, selectedPlan, totalAmountText, selectedEquipment);
                    
                    // Mostrar modal de sucesso
                    document.getElementById('confirmationEmail').textContent = clientEmail;
                    document.getElementById('successModal').classList.remove('hidden');
                    document.getElementById('successModal').classList.add('flex');
                })
                .catch((error) => {
                    console.error("Erro ao salvar reserva no Firestore:", error);
                    alert("Erro ao finalizar reserva. Tente novamente. Erro: " + error.message);
                });
        }


        async function processCancel() {
            const email = document.getElementById('cancelEmail').value;
            const cro = document.getElementById('cancelCRO').value;
            const date = document.getElementById('cancelDate').value;

            if (!email || !cro || !date) {
                alert("Por favor, preencha todos os campos.");
                return;
            }

            console.log("üîç Buscando reserva no banco...");
            const querySnapshot = await db.collection("reservations")
                .where("email", "==", email)
                .where("cro", "==", cro)
                .where("date", "==", date)
                .get();

            if (querySnapshot.empty) {
                alert("Nenhuma reserva encontrada. Verifique se os dados est√£o corretos.");
                return;
            }

            const docData = querySnapshot.docs[0].data();
            const valorEstorno = docData.totalAmount || "0,00";
            const nomeCliente = docData.clientName || "Profissional";

            console.log("‚úÖ Reserva encontrada. Valor:", valorEstorno);

            // Deleta do Firebase
            const batch = db.batch();
            querySnapshot.forEach((doc) => {
                batch.delete(doc.ref);
            });
            await batch.commit();
            console.log("üóëÔ∏è Reserva exclu√≠da do banco.");

            // ENVIA O EMAIL E ESPERA A RESPOSTA ANTES DE DAR SUCESSO
            console.log("üìß Tentando enviar e-mail para Mariana...");
            
            try {
                await sendRefundNotification(email, cro, date, valorEstorno, nomeCliente);
                alert("Cancelamento realizado com sucesso! O e-mail de estorno foi enviado para Mariana.");
                await new Promise(resolve => setTimeout(resolve, 2000));
                location.reload();
            } catch (e) {
                console.error("‚ùå Erro fatal no envio do e-mail:", e);
                alert("A reserva foi exclu√≠da, mas o e-mail n√£o foi enviado. Verifique o console (F12).");
            }
        }

        function sendEmailConfirmation(email, name, cro, phone, date, time, plan, total, equipment) {
            const equipmentList = equipment.length > 0 ? 
                `Equipamentos/Materiais Adicionais:\n${equipment.map(item => `‚Ä¢ ${item}`).join('\n')}\n\n` : '';
            
            const SERVICE_ID = 'service_s2cozam';
            const TEMPLATE_ID = 'template_8u47tu5';
            const PUBLIC_KEY = '7CIpJQwSMHZZWH_Ng';
            
            const templateParams = {
                email: email, // Alterado de user_email para email para bater com {{email}} do painel
                user_name: name,
                reply_to: 'marianadelgadodentista@gmail.com', // Respostas do cliente v√£o para voc√™
                to_name: name,
                from_name: 'Galeria Coworking Odontol√≥gico',
                subject: '‚úÖ Reserva Confirmada - Galeria Coworking',
                message: `ü¶∑ GALERIA COWORKING ODONTOL√ìGICO

        ‚úÖ RESERVA CONFIRMADA!

        üìã DADOS DO PROFISSIONAL:
        ‚Ä¢ Nome: ${name}
        ‚Ä¢ CRO: ${cro}
        ‚Ä¢ Telefone: ${phone}
        ‚Ä¢ Email: ${email}

        üìÖ DETALHES DA RESERVA:
        ‚Ä¢ Data: ${new Date(date).toLocaleDateString('pt-BR')}
        ‚Ä¢ Hor√°rio: ${time}
        ‚Ä¢ Plano: ${plan}
        ‚Ä¢ Valor Total: ${total}

        ${equipmentList}üìç ENDERE√áO:
        Galeria Coworking Odontol√≥gico
        [Seu endere√ßo completo aqui]

        üìû CONTATO:
        WhatsApp: (32) 99909-4126
        Email: marianadelgadodentista@gmail.com

        ‚ö†Ô∏è IMPORTANTE:
        ‚Ä¢ Chegue 15 minutos antes do hor√°rio
        ‚Ä¢ Traga seus materiais b√°sicos
        ‚Ä¢ Cancelamentos at√© 24h antes

        Obrigado por escolher a Galeria Coworking!`
            };
            
            console.log('üìß Enviando email de confirma√ß√£o...');
            emailjs.send(SERVICE_ID, TEMPLATE_ID, templateParams, PUBLIC_KEY)
                .then(function(response) {
                    console.log('‚úÖ EMAIL ENVIADO COM SUCESSO!', response);
                }, function(error) {
                    console.log('‚ùå ERRO AO ENVIAR EMAIL:', error);
                });
        }

        // function sendOwnerNotification(clientEmail, clientName, clientCRO, clientPhone, selectedDate, selectedTimeText, selectedPlan, totalAmount, selectedEquipment) {
        //     const equipmentList = selectedEquipment.length > 0 ? 
        //         `Equipamentos/Materiais Solicitados:\n${selectedEquipment.map(item => `‚Ä¢ ${item}`).join('\n')}\n\n` : '';
            
        //     const SERVICE_ID = 'service_s2cozam';
        //     const TEMPLATE_ID = 'template_8u47tu5';
        //     const PUBLIC_KEY = '7CIpJQwSMHZZWH_Ng';
            
        //     const OWNER_EMAIL = 'marianadelgadodentista@gmail.com'; 
            
        //     const ownerTemplateParams = {
        //         email: OWNER_EMAIL, // Alterado para email para evitar o erro 422 no seu e-mail tamb√©m
        //         user_name: 'Propriet√°rio Galeria Coworking',
        //         reply_to: clientEmail,
        //         to_name: 'Mariana',
        //         from_name: 'Sistema Galeria Coworking',
        //         subject: 'üîî NOVA RESERVA CONFIRMADA - Galeria Coworking',
        //         message: `ü¶∑ NOVA RESERVA NO COWORKING!

        // üîî NOTIFICA√á√ÉO DE RESERVA CONFIRMADA

        // üë®‚Äç‚öïÔ∏è DADOS DO PROFISSIONAL:
        // ‚Ä¢ Nome: ${clientName}
        // ‚Ä¢ CRO: ${clientCRO}
        // ‚Ä¢ Telefone: ${clientPhone}
        // ‚Ä¢ Email: ${clientEmail}

        // üìÖ DETALHES DA RESERVA:
        // ‚Ä¢ Data: ${new Date(selectedDate).toLocaleDateString('pt-BR')}
        // ‚Ä¢ Hor√°rio: ${selectedTimeText}
        // ‚Ä¢ Plano: ${selectedPlan}
        // ‚Ä¢ Valor Total: ${totalAmount}

        // ${equipmentList}üí∞ STATUS DO PAGAMENTO:
        // ‚Ä¢ M√©todo: PIX
        // ‚Ä¢ Status: Confirmado pelo cliente
        // ‚Ä¢ Valor: ${totalAmount}

        // Sistema Galeria Coworking`
        //     };
            
        //     console.log('üìß Enviando notifica√ß√£o para o propriet√°rio...');
            
        //     emailjs.send(SERVICE_ID, TEMPLATE_ID, ownerTemplateParams, PUBLIC_KEY)
        //         .then(function(response) {
        //             console.log('‚úÖ Notifica√ß√£o enviada para o propriet√°rio!', response);
        //         }, function(error) {
        //             console.log('‚ùå Erro ao enviar notifica√ß√£o para propriet√°rio:', error);
        //         });
        // }

        function sendRefundNotification(clientEmail, clientCRO, cancelDate, valor, nome) {
            const SERVICE_ID = 'service_s2cozam';
            const TEMPLATE_ID = 'template_8u47tu5';
            const PUBLIC_KEY = '7CIpJQwSMHZZWH_Ng';

            const templateParams = {
                email: 'mariodontologia1@gmail.com', // DESTINAT√ÅRIO FIXO
                subject: '‚ö†Ô∏è PEDIDO DE ESTORNO - ' + nome,
                message: `Ol√° Mariana,
                
        Uma reserva foi CANCELADA. Dados para o estorno PIX:

        üí∞ VALOR: R$ ${valor}
        üë§ CLIENTE: ${nome}
        üìß CHAVE PIX (E-mail): ${clientEmail}
        üÜî CRO: ${clientCRO}
        üìÖ DATA CANCELADA: ${new Date(cancelDate).toLocaleDateString('pt-BR')}

        Por favor, realize a devolu√ß√£o do valor via PIX.`
            };

            console.log('üìß Tentando enviar e-mail de estorno...');
            emailjs.send(SERVICE_ID, TEMPLATE_ID, templateParams, PUBLIC_KEY)
                .then(function(response) {
                    console.log('‚úÖ E-mail de estorno ENVIADO!', response.status, response.text);
                }, function(error) {
                    console.log('‚ùå FALHA NO EMAILJS:', error);
                    // Se der erro 422 aqui, o problema est√° no "To Email" do seu painel EmailJS
                });
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            fetchOccupiedSlots(); 
            
            document.getElementById('bookingForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                if (!selectedDate || !selectedPlan || !document.getElementById('timeSlot').value) {
                    alert('Por favor, selecione uma data, um plano e um hor√°rio.');
                    return;
                }
                
                const total = document.getElementById('totalPrice').textContent;
                document.getElementById('pixAmount').textContent = total;
                
                document.getElementById('pixModal').classList.remove('hidden');
                document.getElementById('pixModal').classList.add('flex');
            });

            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', calculateTotal);
            });

            emailjs.init("___EMAILJS_PUBLIC_KEY___");
        });
    </script>
    
</head>
<body>
    <header class="bg-textdark text-textlight shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <a href="#home" class="flex items-center hover:opacity-80 transition-opacity">
                    <img src="imagens/image.png" alt="Galeria Odontologia Integrada Logo" class="h-10 w-auto"> 
                </a>
                <nav class="hidden md:flex space-x-6">
                    <a href="#home" class="hover:text-accent transition-colors">In√≠cio</a>
                    <a href="#about" class="hover:text-accent transition-colors">Sobre</a>
                    <a href="#services" class="hover:text-accent transition-colors">Servi√ßos</a>
                    <a href="#booking" onclick="scrollToBooking()" class="bg-accent text-white px-4 py-2 rounded-lg hover:bg-cyan-600 transition-colors">Agendar</a>
                </nav>
            </div>
        </div>
    </header>

    <section id="home" class="gradient-bg text-textdark py-20 relative overflow-hidden">
        <div class="container mx-auto px-6 text-center relative z-10">
            <div class="flex flex-col items-center justify-center mb-6 fade-in">
                <img src="imagens/image.png" alt="Galeria Odontologia Integrada Logo" class="mx-auto max-h-40 w-auto mb-4">
                
                <h2 class="text-6xl logo-principal text-textdark">galeria.</h2>
                <p class="logo-secundaria text-textdark text-xl mt-3 opacity-80">Odontologia Integrada</p>
            </div>
            
            <p class="text-xl mb-8 max-w-3xl mx-auto fade-in text-textdark">Atenda seus pacientes com flexibilidade, conforto e tecnologia de ponta. Reserve por hora, turno ou dia inteiro.</p>
            
            <button onclick="scrollToBooking()" class="bg-accent text-white px-8 py-4 rounded-lg font-semibold text-lg hover:bg-[#7e5748] transition-colors shadow-lg fade-in button-effect">
                Fazer Reserva
            </button>
        </div>

        <div class="mt-8 text-center">
            <button onclick="document.getElementById('cancelModal').classList.remove('hidden')" class="text-sm text-gray-500 underline hover:text-red-600 transition-colors">
                Deseja cancelar uma reserva existente?
            </button>
        </div>

    </section>

    <section id="about" class="py-16 bg-secondary"> 
        <div class="container mx-auto px-6">
            <div class="text-center mb-12">
                <h3 class="text-4xl font-bold text-textdark mb-4">Quem Somos?</h3>
                <p class="text-lg text-gray-600 max-w-4xl mx-auto">
                    A Galeria √© um espa√ßo de coworking odontol√≥gico que permite que o Cirurgi√£o-Dentista atenda seus pacientes com flexibilidade, conforto, praticidade e muita tecnologia.
                </p>
            </div>
            
            <div class="grid md:grid-cols-3 gap-8">
                <div class="text-center card-hover bg-white p-8 rounded-xl shadow-md">
                    <div class="w-16 h-16 bg-accent rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-white" viewBox="0 0 100 100" fill="currentColor"><path d="M20 30 Q50 10 80 30 Q50 50 20 30 M45 25 L55 25 M50 20 L50 35"/></svg>
                    </div>
                    <h4 class="text-xl font-semibold mb-3 text-textdark">Flexibilidade</h4>
                    <p class="text-gray-600">Reserve por hora, turno ou dia inteiro conforme sua demanda</p>
                </div>
                
                <div class="text-center card-hover bg-white p-8 rounded-xl shadow-md">
                    <div class="w-16 h-16 bg-accent rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-white" viewBox="0 0 100 100" fill="currentColor"><rect x="20" y="40" width="60" height="30" rx="5"/><circle cx="30" cy="35" r="8"/><circle cx="70" cy="35" r="8"/><path d="M25 25 L35 35 M65 35 L75 25"/></svg>
                    </div>
                    <h4 class="text-xl font-semibold mb-3 text-textdark">Tecnologia</h4>
                    <p class="text-gray-600">Equipamentos modernos e sistema integrado inclusos</p>
                </div>
                
                <div class="text-center card-hover bg-white p-8 rounded-xl shadow-md">
                    <div class="w-16 h-16 bg-accent rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-white" viewBox="0 0 100 100" fill="currentColor"><rect x="25" y="30" width="50" height="35" rx="5"/><path d="M35 45 L45 50 L65 35"/><circle cx="40" cy="20" r="8"/></svg>
                    </div>
                    <h4 class="text-xl font-semibold mb-3 text-textdark">Praticidade</h4>
                    <p class="text-gray-600">Agendamento online com pagamento antecipado via PIX</p>
                </div>
            </div>
        </div>
    </section>

    <section id="video-tour" class="py-12 bg-white">
        <div class="container mx-auto px-6 text-center">
            <h3 class="text-3xl font-bold text-textdark mb-6">Conhe√ßa Nosso Espa√ßo</h3>
            <div class="max-w-2xl mx-auto rounded-xl overflow-hidden shadow-lg bg-black">
                <video controls class="w-full h-auto">
                    <source src="videos/video_clinica_mp4.mp4" type="video/mp4">
                    Seu navegador n√£o suporta a exibi√ß√£o de v√≠deos.
                </video>
            </div>
        </div>
    </section>

    <section id="services" class="py-16 bg-gray-50">
        <div class="container mx-auto px-6">
            <h3 class="text-4xl font-bold text-center text-textdark mb-12">Valores e Servi√ßos</h3>
            
            <div class="grid md:grid-cols-3 gap-8 mb-12">
                <div class="bg-white rounded-xl shadow-lg p-8 card-hover relative overflow-hidden">
                    <div class="relative z-10">
                        <h4 class="text-2xl font-bold text-accent mb-4">Por Hora</h4>
                        <div class="text-4xl font-bold text-textdark mb-4">R$ 70<span class="text-lg text-gray-500">/hora</span></div>
                        <p class="text-gray-600 mb-6">Ideal para consultas r√°pidas e procedimentos simples</p>
                        <button onclick="selectPlan('hora', 70)" class="w-full bg-accent text-white py-3 rounded-lg hover:bg-[#7e5748] transition-colors button-effect">
                            Selecionar
                        </button>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-8 card-hover border-2 border-accent relative overflow-hidden">
                    <div class="relative z-10">
                        <div class="bg-accent text-white px-3 py-1 rounded-full text-sm inline-block mb-4">Mais Popular</div>
                        <h4 class="text-2xl font-bold text-accent mb-4">Por Turno</h4>
                        <div class="text-4xl font-bold text-textdark mb-4">R$ 150<span class="text-lg text-gray-500">/turno</span></div>
                        <p class="text-gray-600 mb-6">Manh√£: 08h √†s 12h | Tarde: 13h √†s 17h</p>
                        <button onclick="selectPlan('turno', 150)" class="w-full bg-accent text-white py-3 rounded-lg hover:bg-[#7e5748] transition-colors button-effect">
                            Selecionar
                        </button>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-8 card-hover relative overflow-hidden">
                    <div class="relative z-10">
                        <h4 class="text-2xl font-bold text-accent mb-4">Dia Completo</h4>
                        <div class="text-4xl font-bold text-textdark mb-4">R$ 300<span class="text-lg text-gray-500">/dia</span></div>
                        <p class="text-gray-600 mb-6">8h √†s 18h - Para dias intensivos de atendimento</p>
                        <button onclick="selectPlan('dia', 300)" class="w-full bg-accent text-white py-3 rounded-lg hover:bg-[#7e5748] transition-colors button-effect">
                            Selecionar
                        </button>
                    </div>
                </div>
            </div>

            <div class="max-w-xl mx-auto mt-16">
                <div class="bg-white rounded-xl shadow-lg p-8">
                    <h4 class="text-2xl font-bold text-textdark mb-6 text-center">Tabela de Taxas Extras</h4>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center p-3 bg-primary bg-opacity-20 rounded-lg"><span>Fotopolimerizador</span><span class="font-semibold text-accent">R$ 5,00/h</span></div>
                        <div class="flex justify-between items-center p-3 bg-primary bg-opacity-20 rounded-lg"><span>Ultrassom e jato de bicarbonato</span><span class="font-semibold text-accent">R$ 5,00/h</span></div>
                        <div class="flex justify-between items-center p-3 bg-primary bg-opacity-20 rounded-lg"><span>Autoclave</span><span class="font-semibold text-accent">R$ 20,00/ciclo</span></div>
                        <div class="flex justify-between items-center p-3 bg-primary bg-opacity-20 rounded-lg"><span>Laser de baixa pot√™ncia</span><span class="font-semibold text-accent">R$ 20,00/h</span></div>
                        <div class="flex justify-between items-center p-3 bg-primary bg-opacity-20 rounded-lg"><span>Raio X port√°til com sensor digital</span><span class="font-semibold text-accent">R$ 50,00/h</span></div>
                        <div class="flex justify-between items-center p-3 bg-primary bg-opacity-20 rounded-lg"><span>Kit de dent√≠stica</span><span class="font-semibold text-accent">R$ 20,00/h</span></div>
                        <div class="flex justify-between items-center p-3 bg-primary bg-opacity-20 rounded-lg"><span>Kit de pr√≥tese</span><span class="font-semibold text-accent">R$ 30,00/h</span></div>
                        <div class="flex justify-between items-center p-3 bg-primary bg-opacity-20 rounded-lg"><span>Kit de cirurgia est√©ril</span><span class="font-semibold text-accent">R$ 80,00/kit</span></div>
                        <div class="flex justify-between items-center p-3 bg-primary bg-opacity-20 rounded-lg"><span>Kit clareamento consult√≥rio</span><span class="font-semibold text-accent">R$ 65,00/h</span></div>
                        <div class="flex justify-between items-center p-3 bg-primary bg-opacity-20 rounded-lg"><span>Kit clareamento caseiro</span><span class="font-semibold text-accent">R$ 90,00/kit</span></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="booking" class="py-16 bg-secondary"> 
        <div class="container mx-auto px-6">
            <h3 class="text-4xl font-bold text-center text-textdark mb-12">Fazer Reserva</h3>
            
            <div class="max-w-4xl mx-auto">
                <div class="grid md:grid-cols-2 gap-8">
                    <div class="bg-white rounded-xl p-6 shadow-lg">
                        <h4 class="text-xl font-semibold mb-4 text-textdark">1. Selecione a Data</h4>
                        <div id="calendar" class="bg-gray-50 rounded-lg p-4">
                            Carregando Calend√°rio...
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl p-6 shadow-lg">
                        <h4 class="text-xl font-semibold mb-4 text-textdark">2. Detalhes da Reserva</h4>
                        <form id="bookingForm" class="space-y-4">
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Nome Completo</label>
                                <input type="text" id="clientName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">CRO</label>
                                <input type="text" id="cro" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Telefone</label>
                                <input type="tel" id="phone" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                <input type="email" id="email" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent" placeholder="seu@email.com">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Plano Selecionado</label>
                                <div id="selectedPlan" class="px-4 py-2 bg-accent text-white rounded-lg">
                                    Selecione um plano acima
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Hor√°rio</label>
                                <select id="timeSlot" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent">
                                    <option value="">Selecione data e plano primeiro</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Equipamentos e Materiais Adicionais</label>
                                <div class="space-y-2 max-h-40 overflow-y-auto p-2 bg-gray-50 rounded-lg border border-gray-200">
                                    <label class="flex items-center text-sm">
                                        <input type="checkbox" value="fotopolimerizador" class="mr-2 text-accent focus:ring-accent"> Fotopolimerizador (R$ 5,00/h)
                                    </label>
                                    <label class="flex items-center text-sm">
                                        <input type="checkbox" value="ultrassom" class="mr-2 text-accent focus:ring-accent"> Ultrassom e jato (R$ 5,00/h)
                                    </label>
                                    <label class="flex items-center text-sm">
                                        <input type="checkbox" value="autoclave" class="mr-2 text-accent focus:ring-accent"> Autoclave (R$ 20,00/ciclo)
                                    </label>
                                    <label class="flex items-center text-sm">
                                        <input type="checkbox" value="laser" class="mr-2 text-accent focus:ring-accent"> Laser baixa pot√™ncia (R$ 20,00/h)
                                    </label>
                                    <label class="flex items-center text-sm">
                                        <input type="checkbox" value="raioX" class="mr-2 text-accent focus:ring-accent"> Raio X port√°til (R$ 50,00/h)
                                    </label>
                                    <label class="flex items-center text-sm">
                                        <input type="checkbox" value="kitDentistica" class="mr-2 text-accent focus:ring-accent"> Kit de dent√≠stica (R$ 20,00/h)
                                    </label>
                                    <label class="flex items-center text-sm">
                                        <input type="checkbox" value="kitProtese" class="mr-2 text-accent focus:ring-accent"> Kit de pr√≥tese (R$ 30,00/h)
                                    </label>
                                    <label class="flex items-center text-sm">
                                        <input type="checkbox" value="kitCirurgia" class="mr-2 text-accent focus:ring-accent"> Kit de cirurgia est√©ril (R$ 80,00/kit)
                                    </label>
                                    <label class="flex items-center text-sm">
                                        <input type="checkbox" value="kitClareamentoConsultorio" class="mr-2 text-accent focus:ring-accent"> Kit clareamento consult√≥rio (R$ 65,00/h)
                                    </label>
                                    <label class="flex items-center text-sm">
                                        <input type="checkbox" value="kitClareamentoCaseiro" class="mr-2 text-accent focus:ring-accent"> Kit clareamento caseiro (R$ 90,00/kit)
                                    </label>
                                </div>
                            </div>
                            
                            <div class="border-t pt-4">
                                <div class="flex justify-between items-center mb-4">
                                    <span class="font-semibold text-textdark">Total:</span>
                                    <span id="totalPrice" class="text-2xl font-bold text-accent">R$ 0,00</span>
                                </div>
                                
                                <button type="submit" class="w-full bg-accent text-white py-3 rounded-lg hover:bg-[#7e5748] transition-colors font-semibold button-effect">
                                    3. Pagar com PIX
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <div id="pixModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4">
            <h3 class="text-2xl font-bold text-center mb-6 text-textdark">Pagamento PIX</h3>
            
            <div class="text-center mb-6">
                <div class="w-48 h-48 bg-gray-200 rounded-lg mx-auto mb-4 flex items-center justify-center">
                    <div class="text-6xl">üì±</div>
                    <div class="w-48 h-48 bg-gray-200 rounded-lg mx-auto mb-4 flex items-center justify-center border-2 border-dashed border-accent">
    <img src="imagens/qr_code_mari.png" alt="QR Code PIX Mariana" class="max-w-full max-h-full">
</div>
                </div>
                <p class="text-gray-600 mb-2">Escaneie o QR Code com seu app do banco</p>
                <p class="text-sm text-gray-500">Ou copie a chave PIX abaixo:</p>
            </div>
            
            <div class="bg-primary bg-opacity-30 p-4 rounded-lg mb-6">
                <p class="text-xs text-textdark mb-2">Chave PIX (E-mail)</p>
                <p id="pixKey" class="font-mono text-sm break-all text-textdark">marianadelgadodentista@gmail.com</p>
                <button onclick="copyPixKey()" class="mt-2 text-accent text-sm hover:underline">Copiar chave</button>
            </div>

            <div class="mb-4 text-left">
                <label class="block text-xs font-bold text-gray-700 mb-1">Anexar Comprovante (Obrigat√≥rio):</label>
                <input type="file" id="pixFile" accept="image/*,application/pdf" 
                    class="w-full text-xs p-2 border rounded bg-white file:mr-4 file:py-1 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-accent file:text-white hover:file:bg-[#7e5748]">
            </div>
            
            <div class="text-center mb-6">
                <p class="text-lg font-semibold text-textdark">Valor: <span id="pixAmount" class="text-2xl font-bold text-accent">R$ 0,00</span></p>
            </div>
            
            <div class="flex space-x-4">
                <button onclick="closePixModal()" class="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg hover:bg-gray-400 transition-colors">
                    Cancelar
                </button>
                <button onclick="confirmPayment()" class="flex-1 bg-accent text-white py-3 rounded-lg hover:bg-[#7e5748] transition-colors button-effect">
                    Confirmar Pagamento
                </button>
            </div>
        </div>
    </div>

    <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 text-center">
            <div class="text-6xl mb-4 text-accent">‚úÖ</div>
            <h3 class="text-2xl font-bold text-accent mb-4">Reserva Confirmada!</h3>
            <p class="text-gray-600 mb-4">Sua reserva foi realizada com sucesso!</p>
            <div class="bg-primary bg-opacity-30 p-4 rounded-lg mb-6">
                <p class="text-sm text-textdark mb-2">üìß <strong>Confirma√ß√£o enviada para:</strong></p>
                <p id="confirmationEmail" class="text-textdark font-semibold"></p>
                <p class="text-xs text-gray-600 mt-2">Verifique sua caixa de entrada e spam</p>
            </div>
            <button onclick="closeSuccessModal()" class="bg-accent text-white px-6 py-3 rounded-lg hover:bg-[#7e5748] transition-colors button-effect">
                Fechar
            </button>
        </div>
    </div>

    <div id="cancelModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4">
        <h3 class="text-2xl font-bold text-accent mb-4 text-center">Cancelar Agenda</h3>
        <p class="text-gray-600 mb-6 text-sm text-center">Insira o e-mail utilizado na reserva e a data para cancelar.</p>
        
        <div class="space-y-4">
            <input type="email" id="cancelEmail" placeholder="E-mail da reserva" class="w-full p-3 border rounded-lg focus:ring-accent focus:border-accent">
            <input type="text" id="cancelCRO" placeholder="Seu CRO" class="w-full p-3 border rounded-lg">
            <input type="date" id="cancelDate" class="w-full p-3 border rounded-lg focus:ring-accent focus:border-accent">
        </div>

        <div class="flex gap-4 mt-8">
            <button onclick="document.getElementById('cancelModal').classList.add('hidden')" class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg hover:bg-gray-300 transition-colors">
                Voltar
            </button>
            <button onclick="processCancel()" class="flex-1 bg-accent text-white py-3 rounded-lg hover:bg-opacity-90 transition-colors font-bold">
                Confirmar Cancelamento
            </button>
        </div>
    </div>
</div>
    
</body>
</html>