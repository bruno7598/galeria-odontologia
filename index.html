<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galeria Coworking Odontol√≥gico</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FBF8E9', 
                        secondary: '#FBF8E9', 
                        accent: '#996E5C', 
                        textdark: '#89878C', 
                        textlight: '#FBF8E9' 
                    }
                }
            }
        }
    </script>
    <style>
        body { box-sizing: border-box; color: #89878C; }
        .logo-principal { font-family: ui-serif, Georgia, serif; font-weight: 700; text-transform: lowercase; }
        .logo-secundaria { font-family: ui-sans-serif, system-ui, sans-serif; font-weight: 500; letter-spacing: 0.1em; text-transform: uppercase; }
        .gradient-bg { background: linear-gradient(135deg, #FBF8E9 0%, #EFEBE0 100%); }
        .card-hover { transition: all 0.4s ease; }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 15px 30px -5px rgba(0, 0, 0, 0.1); }
        .calendar-day { transition: all 0.2s ease; cursor: pointer; border-radius: 0.5rem; padding: 0.5rem; text-align: center; }
        .calendar-day:hover:not(.text-gray-400) { background-color: #996E5C; color: white; }
        .selected { background-color: #996E5C !important; color: white; font-weight: bold; }
        .tooltip { position: relative; }
        .tooltip .tooltiptext { visibility: hidden; width: 140px; background-color: #3C403B; color: #fff; text-align: center; border-radius: 6px; padding: 5px; position: absolute; z-index: 10; bottom: 125%; left: 50%; margin-left: -70px; opacity: 0; transition: opacity 0.3s; font-size: 10px; }
        .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }
        
        /* Estilo do Campo de Upload */
        .file-upload-wrapper { border: 2px dashed #996E5C; padding: 15px; border-radius: 10px; text-align: center; background: #fdfcf4; margin-top: 15px; }
    </style>
    
    <script>
        // --- CONFIGURA√á√ÉO FIREBASE ---
        const firebaseConfig = {
            apiKey: "AIzaSyDh40_kOaZeZYnx89QeH0C21Ngmw7Sf15s",
            authDomain: "mari-clinica.firebaseapp.com",
            projectId: "mari-clinica",
            storageBucket: "mari-clinica.firebasestorage.app",
            messagingSenderId: "856573842291",
            appId: "1:856573842291:web:ce80a6e8e737fc16b3eb06",
            measurementId: "G-7JL8YJW008"
        };

        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore(app);

        // --- VARI√ÅVEIS DE CONTROLE ---
        let selectedDate = null;
        let selectedPlan = null;
        let selectedPlanPrice = 0;
        let occupiedSlots = {}; 
        const OWNER_EMAIL = 'mariodontologia1@gmail.com'; 

        async function fetchOccupiedSlots() {
            try {
                const snapshot = await db.collection("reservations").get();
                occupiedSlots = {};
                snapshot.forEach(doc => {
                    const data = doc.data();
                    if (!occupiedSlots[data.date]) occupiedSlots[data.date] = [];
                    occupiedSlots[data.date].push({ time: data.time, client: data.clientDescription });
                });
                generateCalendar(); 
            } catch (error) {
                console.error("Erro Firebase:", error);
                generateCalendar(); 
            }
        }

        function generateCalendar() {
            const calendar = document.getElementById('calendar');
            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            const monthNames = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            
            let html = `<div class="text-center mb-4"><h5 class="font-bold">${monthNames[currentMonth]} ${currentYear}</h5></div>`;
            html += `<div class="grid grid-cols-7 gap-1 text-xs font-bold text-center mb-2"><div>Dom</div><div>Seg</div><div>Ter</div><div>Qua</div><div>Qui</div><div>Sex</div><div>S√°b</div></div>`;
            html += `<div class="grid grid-cols-7 gap-1">`;

            for (let i = 0; i < firstDay; i++) html += '<div></div>';
            
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(currentYear, currentMonth, day);
                const dateStr = date.toISOString().split('T')[0];
                const isPast = date < new Date().setHours(0,0,0,0);
                const dayOcc = occupiedSlots[dateStr] || [];
                
                let cls = 'calendar-day';
                if (isPast) cls += ' text-gray-400 cursor-not-allowed';
                else if (dayOcc.length > 0) cls += ' bg-yellow-100 text-yellow-800 tooltip';

                html += `<div class="${cls}" onclick="${!isPast ? `selectDate('${dateStr}', this)` : ''}">${day}${dayOcc.length > 0 ? `<span class="tooltiptext">Ocupado</span>` : ''}</div>`;
            }
            calendar.innerHTML = html + `</div>`;
        }

        function selectDate(dateString, element) {
            document.querySelectorAll('.calendar-day').forEach(d => d.classList.remove('selected'));
            element.classList.add('selected');
            selectedDate = dateString;
            updateTimeSlots();
        }

        function selectPlan(plan, price) {
            selectedPlan = plan;
            selectedPlanPrice = price;
            document.getElementById('selectedPlan').textContent = plan.toUpperCase();
            updateTimeSlots();
            calculateTotal();
            document.getElementById('booking').scrollIntoView({ behavior: 'smooth' });
        }

        function updateTimeSlots() {
            const slot = document.getElementById('timeSlot');
            if (!selectedPlan || !selectedDate) {
                slot.innerHTML = '<option>Selecione plano e data</option>';
                return;
            }
            let options = '<option value="">Selecione o hor√°rio</option>';
            if (selectedPlan === 'hora') {
                ['08:00', '10:00', '14:00', '16:00'].forEach(h => options += `<option value="${h}">${h}</option>`);
            } else if (selectedPlan === 'turno') {
                options += '<option value="08:00">Manh√£ (08h-12h)</option><option value="13:00">Tarde (13h-17h)</option>';
            } else {
                options += '<option value="08:00">Dia Completo</option>';
            }
            slot.innerHTML = options;
        }

        function calculateTotal() {
            let total = selectedPlanPrice;
            document.querySelectorAll('input[type="checkbox"]:checked').forEach(c => total += 10); // Simplificado para exemplo
            document.getElementById('totalPrice').textContent = `R$ ${total.toFixed(2)}`;
        }

        // --- FUN√á√ïES DE PAGAMENTO E COMPROVANTE ---
        function copyPixKey() {
            navigator.clipboard.writeText('mariodontologia1@gmail.com');
            alert('Chave PIX copiada!');
        }

        function validateAndConfirm() {
            const fileInput = document.getElementById('receiptFile');
            if (fileInput.files.length === 0) {
                alert("‚ö†Ô∏è Erro: Voc√™ precisa anexar a foto do comprovante PIX para continuar.");
                return;
            }
            confirmPayment();
        }

        function confirmPayment() {
            const btn = document.getElementById('btnConfirmar');
            btn.innerText = "Processando...";
            btn.disabled = true;

            const data = {
                clientName: document.getElementById('clientName').value,
                email: document.getElementById('email').value,
                date: selectedDate,
                time: document.getElementById('timeSlot').value,
                total: document.getElementById('totalPrice').textContent,
                status: 'Aguardando Confer√™ncia de Comprovante'
            };

            db.collection("reservations").add(data).then(() => {
                // Aqui chamaria o EmailJS (usando seus IDs salvos)
                alert("Reserva enviada com sucesso! Analisaremos seu comprovante.");
                location.reload();
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            fetchOccupiedSlots();
            document.getElementById('bookingForm').addEventListener('submit', (e) => {
                e.preventDefault();
                document.getElementById('pixAmount').textContent = document.getElementById('totalPrice').textContent;
                document.getElementById('pixModal').classList.remove('hidden');
                document.getElementById('pixModal').classList.add('flex');
            });
            emailjs.init('ckNNBdvQMD-hnrc_T');
        });
    </script>
</head>

<body class="bg-primary">
    <header class="bg-textdark text-white p-4 sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="logo-principal text-2xl">galeria.</h1>
            <button onclick="document.getElementById('booking').scrollIntoView()" class="bg-accent px-4 py-2 rounded">Reservar</button>
        </div>
    </header>

    <main class="container mx-auto px-6 py-10">
        <section id="services" class="grid md:grid-cols-3 gap-6 mb-12">
            <div class="bg-white p-6 rounded-xl shadow card-hover text-center">
                <h3 class="font-bold text-xl">Por Hora</h3>
                <p class="text-2xl font-bold text-accent my-4">R$ 70,00</p>
                <button onclick="selectPlan('hora', 70)" class="bg-accent text-white w-full py-2 rounded">Selecionar</button>
            </div>
            <div class="bg-white p-6 rounded-xl shadow card-hover text-center border-2 border-accent">
                <h3 class="font-bold text-xl">Por Turno</h3>
                <p class="text-2xl font-bold text-accent my-4">R$ 150,00</p>
                <button onclick="selectPlan('turno', 150)" class="bg-accent text-white w-full py-2 rounded">Selecionar</button>
            </div>
            <div class="bg-white p-6 rounded-xl shadow card-hover text-center">
                <h3 class="font-bold text-xl">Dia Inteiro</h3>
                <p class="text-2xl font-bold text-accent my-4">R$ 300,00</p>
                <button onclick="selectPlan('dia', 300)" class="bg-accent text-white w-full py-2 rounded">Selecionar</button>
            </div>
        </section>

        <section id="booking" class="bg-white p-8 rounded-2xl shadow-lg grid md:grid-cols-2 gap-10">
            <div>
                <h3 class="text-2xl font-bold mb-6">1. Escolha a Data</h3>
                <div id="calendar" class="bg-gray-50 p-4 rounded-xl shadow-inner"></div>
            </div>
            <div>
                <h3 class="text-2xl font-bold mb-6">2. Seus Dados</h3>
                <form id="bookingForm" class="space-y-4">
                    <input type="text" id="clientName" placeholder="Nome Completo" class="w-full p-3 border rounded" required>
                    <input type="email" id="email" placeholder="Seu melhor E-mail" class="w-full p-3 border rounded" required>
                    <div class="grid grid-cols-2 gap-4">
                        <input type="text" id="cro" placeholder="CRO" class="w-full p-3 border rounded" required>
                        <input type="text" id="phone" placeholder="WhatsApp" class="w-full p-3 border rounded" required>
                    </div>
                    <select id="timeSlot" class="w-full p-3 border rounded" required>
                        <option value="">Selecione a data primeiro</option>
                    </select>
                    
                    <div class="p-4 bg-primary rounded-lg">
                        <p class="font-bold">Plano: <span id="selectedPlan" class="text-accent">Nenhum</span></p>
                        <p class="text-2xl font-bold">Total: <span id="totalPrice">R$ 0,00</span></p>
                    </div>
                    
                    <button type="submit" class="w-full bg-accent text-white py-4 rounded-xl font-bold text-lg hover:bg-opacity-90 transition-all">
                        Ir para Pagamento (PIX)
                    </button>
                </form>
            </div>
        </section>
    </main>

    <div id="pixModal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center z-[100] p-4">
        <div class="bg-white p-8 rounded-2xl max-w-md w-full shadow-2xl">
            <h3 class="text-2xl font-bold text-center mb-2">Pagamento PIX</h3>
            <p class="text-center text-gray-500 mb-6 text-sm">Sua reserva ficar√° pr√©-agendada at√© confirmarmos o comprovante.</p>
            
            <div class="text-center text-3xl font-bold text-accent mb-6" id="pixAmount">R$ 0,00</div>
            
            <div class="bg-gray-100 p-4 rounded-lg mb-6">
                <p class="text-xs font-bold text-gray-400 uppercase">Chave PIX (E-mail):</p>
                <div class="flex justify-between items-center">
                    <span class="text-sm font-mono">mariodontologia1@gmail.com</span>
                    <button onclick="copyPixKey()" class="text-accent font-bold">Copiar</button>
                </div>
            </div>

            <div class="file-upload-wrapper">
                <p class="text-sm font-bold text-textdark mb-2">üì∏ Anexe o comprovante (Foto/PDF):</p>
                <input type="file" id="receiptFile" accept="image/*,.pdf" class="text-xs w-full">
            </div>

            <div class="grid grid-cols-2 gap-4 mt-6">
                <button onclick="document.getElementById('pixModal').classList.add('hidden')" class="py-3 border rounded-lg font-bold">Cancelar</button>
                <button id="btnConfirmar" onclick="validateAndConfirm()" class="bg-green-600 text-white py-3 rounded-lg font-bold">Confirmar</button>
            </div>
        </div>
    </div>

</body>
</html>